<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Interactive component | COVID-19 Worldwide Research</title>
  <meta name="description" content="Chapter 5 Interactive component | COVID-19 Worldwide Research" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Interactive component | COVID-19 Worldwide Research" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Interactive component | COVID-19 Worldwide Research" />
  
  
  

<meta name="author" content="Sida Huang" />


<meta name="date" content="2022-12-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="results.html"/>
<link rel="next" href="conclusion.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">COVID-19 Worldwide Research</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="proposal.html"><a href="proposal.html"><i class="fa fa-check"></i><b>2</b> Proposal</a>
<ul>
<li class="chapter" data-level="2.1" data-path="proposal.html"><a href="proposal.html#research-topics"><i class="fa fa-check"></i><b>2.1</b> Research Topics</a></li>
<li class="chapter" data-level="2.2" data-path="proposal.html"><a href="proposal.html#data-availability"><i class="fa fa-check"></i><b>2.2</b> Data availability</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="proposal.html"><a href="proposal.html#who-coronavirus-covid-19-dashboard"><i class="fa fa-check"></i><b>2.2.1</b> WHO Coronavirus (COVID-19) Dashboard</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>3</b> Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data.html"><a href="data.html#sources"><i class="fa fa-check"></i><b>3.1</b> Sources</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="data.html"><a href="data.html#daily-cases-and-deaths-by-date-reported-to-who-2"><i class="fa fa-check"></i><b>3.1.1</b> Daily cases and deaths by date reported to WHO</a></li>
<li class="chapter" data-level="3.1.2" data-path="data.html"><a href="data.html#latest-reported-counts-of-cases-and-deaths-2"><i class="fa fa-check"></i><b>3.1.2</b> Latest reported counts of cases and deaths</a></li>
<li class="chapter" data-level="3.1.3" data-path="data.html"><a href="data.html#vaccination-data-2"><i class="fa fa-check"></i><b>3.1.3</b> Vaccination data</a></li>
<li class="chapter" data-level="3.1.4" data-path="data.html"><a href="data.html#vaccination-metadata-2"><i class="fa fa-check"></i><b>3.1.4</b> Vaccination metadata</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="data.html"><a href="data.html#cleaning-transformation"><i class="fa fa-check"></i><b>3.2</b> Cleaning / transformation</a></li>
<li class="chapter" data-level="3.3" data-path="data.html"><a href="data.html#missing-value-analysis"><i class="fa fa-check"></i><b>3.3</b> Missing value analysis</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>4</b> Results</a>
<ul>
<li class="chapter" data-level="4.1" data-path="results.html"><a href="results.html#abstract"><i class="fa fa-check"></i><b>4.1</b> Abstract</a></li>
<li class="chapter" data-level="4.2" data-path="results.html"><a href="results.html#a-brief-look-at-the-spread-of-covid-19-and-vaccinations"><i class="fa fa-check"></i><b>4.2</b> A brief look at the spread of Covid-19 and Vaccinations</a></li>
<li class="chapter" data-level="4.3" data-path="results.html"><a href="results.html#do-vaccinations-really-work"><i class="fa fa-check"></i><b>4.3</b> Do vaccinations really work?</a></li>
<li class="chapter" data-level="4.4" data-path="results.html"><a href="results.html#dive-into-vaccinations"><i class="fa fa-check"></i><b>4.4</b> Dive into Vaccinations</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="interactive-component.html"><a href="interactive-component.html"><i class="fa fa-check"></i><b>5</b> Interactive component</a></li>
<li class="chapter" data-level="6" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>6</b> Conclusion</a>
<ul>
<li class="chapter" data-level="6.1" data-path="conclusion.html"><a href="conclusion.html#conclusion-1"><i class="fa fa-check"></i><b>6.1</b> Conclusion</a></li>
<li class="chapter" data-level="6.2" data-path="conclusion.html"><a href="conclusion.html#limitations"><i class="fa fa-check"></i><b>6.2</b> Limitations</a></li>
<li class="chapter" data-level="6.3" data-path="conclusion.html"><a href="conclusion.html#future-directions"><i class="fa fa-check"></i><b>6.3</b> Future directions</a></li>
<li class="chapter" data-level="6.4" data-path="conclusion.html"><a href="conclusion.html#lesson-learns"><i class="fa fa-check"></i><b>6.4</b> Lesson learns</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">COVID-19 Worldwide Research</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="interactive-component" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Chapter 5</span> Interactive component<a href="interactive-component.html#interactive-component" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<h3>
Monthly newly reported COVID-19 cases
</h3>
<div>
In this part, we use D3 to create a world map that shows the newly reported COVID-19 cases per month in every country. The color scale indicates the number of newly reported cases per month. User can use the form or the buttons to select a specific month and show the result.
</div>
<div id="plot">

</div>
<div>
From the plot we can clearly see how COVID-19 spread over time.At first the COVID-19 spread from China. After two months (from March 2020), the number of newly reported cases in U.S. is far more than the other countries. As time goes by, we can see that U.S., Russia, India and Brazil have the highest number of reported cases in most of the time intervals.
</div>
<style>
path {
  stroke: white;
  stroke-width: 0.25px;
  fill: grey;
}
</style>
<script src="https://d3js.org/d3.v7.js"></script>
<script src="https://unpkg.com/topojson@3"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>
<script>
const width = 1500;
const height = 600;

const form = d3.select('div#plot')
  .append('form')
  .attr('class', 'form-inline');
  
const select = form.append('select')
  .attr('class', 'form-control')
  .attr('id', 'my_month');
const months = ['2020/1/1', '2020/2/1', '2020/3/1', '2020/4/1','2020/5/1','2020/6/1','2020/7/1','2020/8/1','2020/9/1','2020/10/1','2020/11/1','2020/12/1',
  '2021/1/1','2021/2/1','2021/3/1','2021/4/1','2021/5/1','2021/6/1','2021/7/1','2021/8/1','2021/9/1','2021/10/1','2021/11/1','2021/12/1',
  '2022/1/1','2022/2/1','2022/3/1','2022/4/1','2022/5/1','2022/6/1','2022/7/1','2022/8/1','2022/9/1','2022/10/1','2022/11/1','2022/12/1',
];
select.selectAll('option')
  .data(months)
  .enter()
  .append('option')
    .attr('value', d => d)
    .text(d => d);

const prebtn = d3.select('div#plot').append('button').attr('id','premonth').text("Previous month")
const nxtbtn = d3.select('div#plot').append('button').attr('id','nxtmonth').text('Next month')

const covidData = d3.csv('https://raw.githubusercontent.com/amethystorm/public_data_selfuse/main/monthly_with_code.csv').then(function(data){


  let filtered_data = data.filter(d=>d.month == "2020/1/1")
  let colorScale = d3.scaleSequential(d3.interpolateReds)
  .domain([0, d3.max(filtered_data, d => Number(d.New_cases))]);


  const projection = d3.geoMercator()
      .center([0, 5 ])
      .scale(120)
      .rotate([-180,0]);

  const svg = d3.select("div#plot")
      .append("svg")
      .attr("width", width)
      .attr("height", height);

  const path = d3.geoPath()
      .projection(projection);

  const g = svg.append("g");

  let legend = d3.legendColor().scale(colorScale);
  let legend_svg = svg.append("svg")
    .attr("transform", "translate(500,10)")
  
  legend_svg.call(legend);

  // load and display the World
  d3.json("https://unpkg.com/world-atlas@1.1.4/world/110m.json").then(function(topology) {

      g.selectAll("path")
        .data(topojson.feature(topology, topology.objects.countries).features)
        .enter()
        .append("path")
        .attr("d", path)
        .style('fill',d=>{
          const countrydata = filtered_data.find(
            country => Number(country.code) == Number(d.id) 
          )
          if (typeof(countrydata) == "undefined"){
            return colorScale(0)
          }
          else{
            return colorScale(countrydata.New_cases)
          }
          //return countryData ? colorScale(countryData.New_cases) : '#ccc';
        })
        .style('stroke', '#333');

  });

  prebtn.on('click', () => {
    let curmonth = d3.select('.form-control#my_month').node().value;

    currindex = months.findIndex((e)=>e==curmonth)
    preidx = -1
    if (currindex==0){
      preidx = 35
    }
    else{
      preidx = currindex - 1
    }
    month = months[preidx]
    d3.select('.form-control#my_month').node().value = month
    // update the data to only include cases for the selected month
    filtered_data = data.filter(d=>d.month == month)
    // update the color scale
    colorScale.domain([0, d3.max(filtered_data, d => Number(d.New_cases))]);

    legend = d3.legendColor().scale(colorScale);
    legend_svg.call(legend);
    svg.selectAll('path')
    .transition()
    .duration(100)
    .style('fill', d => {
    // find the corresponding data for this country
    const countrydata = filtered_data.find(
      country => Number(country.code) == Number(d.id) 
    )
    if (typeof(countrydata) == "undefined"){
      return colorScale(0)
    }
    else{
      return colorScale(countrydata.New_cases)
    }
    })
  });

  nxtbtn.on('click', () => {
    let curmonth = d3.select('.form-control#my_month').node().value;

    currindex = months.findIndex((e)=>e==curmonth)
    preidx = -1
    if (currindex==35){
      preidx = 0
    }
    else{
      preidx = currindex + 1
    }
    month = months[preidx]
    d3.select('.form-control#my_month').node().value = month
    // update the data to only include cases for the selected month
    filtered_data = data.filter(d=>d.month == month)
      // update the color scale
    colorScale.domain([0, d3.max(filtered_data, d => Number(d.New_cases))]);

    legend = d3.legendColor().scale(colorScale);
    legend_svg.call(legend);

    svg.selectAll('path')
    .transition()
    .duration(100)
    .style('fill', d => {
    // find the corresponding data for this country
    const countrydata = filtered_data.find(
      country => Number(country.code) == Number(d.id) 
    )
    if (typeof(countrydata) == "undefined"){
      return colorScale(0)
    }
    else{
      return colorScale(countrydata.New_cases)
    }
    })
  });

  select.on('change', () => {
  // get the selected month
  const month = d3.select('.form-control#my_month').node().value;

  // update the data to only include cases for the selected month
  filtered_data = data.filter(d=>d.month == month)

  // update the color scale
  colorScale.domain([0, d3.max(filtered_data, d => Number(d.New_cases))]);

    legend = d3.legendColor().scale(colorScale);
    legend_svg.call(legend);
  // console.log(filtered_data)
  // update the colors on the map
  svg.selectAll('path')
  .transition()
  .duration(100)
  .style('fill', d => {
  // find the corresponding data for this country
  const countrydata = filtered_data.find(
    country => Number(country.code) == Number(d.id) 
  )
  if (typeof(countrydata) == "undefined"){
    return colorScale(0)
  }
  else{
    return colorScale(countrydata.New_cases)
  }
  })
});



})

</script>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="results.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="conclusion.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/lucas66zhang/CovidWorldwideResearch/edit/main/interactive.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/lucas66zhang/CovidWorldwideResearch/blob/main/interactive.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
