--- 
title: "COVID-19 Worldwide Research"
author: "Names"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
---
```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```

# Introduction


<!--chapter:end:index.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Proposal
## Research Topics
The final project targets to analyze and visualize the distribution of COVID-19 from different aspects, including how fatality varies around the globe, how the virus spreads out, when and how the variants transform and lead to long-lasting damage, and how recent daily/weekly cases fluctuate. 

Throughout these three years, COVID-19 has severely outbroken and struck the globe, paralyzed our economies and daily lives, and even transformed into different variants leading to continuing catastrophes. In this project, we are dedicated to taking advantage of different visualization tools and techniques from lectures to presenting how COVID-19 affects our globe in these years and digging into deeper insights into why the virus varies from time to time and from country to country.

## Data availability
### WHO Coronavirus (COVID-19) Dashboard
On the WHO Coronavirus (COVID-19) Dashboard [website](https://covid19.who.int/data), there are four datasets opened to be downloaded.

1. Daily cases and deaths by date reported to WHO
2. Latest reported counts of cases and deaths
3. Vaccination data
4. Vaccination metadata

#### Daily cases and deaths by date reported to WHO
[Daily cases and deaths by date reported to WHO](https://covid19.who.int/WHO-COVID-19-global-data.csv)

#### Latest reported counts of cases and deaths
[Latest reported counts of cases and deaths](https://covid19.who.int/WHO-COVID-19-global-table-data.csv)

#### Vaccination data
[Vaccination data](https://covid19.who.int/who-data/vaccination-data.csv)

#### Vaccination metadata
[Vaccination metadata](https://covid19.who.int/who-data/vaccination-metadata.csv)

**Published by:** 
The datasets above is published by the World Health Organization (WHO).

**Data format:** 
The format of the datasets is csv file.

**Frequency of updates: **

According to the description on the WHO COVID-19 Dashboard, the datasets is updated weekly. 

**Data size: **

#### Daily cases and deaths by date reported to WHO
File name: WHO-COVID-19-global-data.csv. Size: 10787 KB.

#### Latest reported counts of cases and deaths
File name: WHO-COVID-19-global-table-data.csv. Size: 17 KB.

#### Vaccination data
File name: vaccination-data.csv. Size: 49 KB.

#### Vaccination metadata
File name: vaccination-metadata.csv. Size: 88 KB.

<!--chapter:end:proposal.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Data

## Sources

As we mentioned in Chapter 2, we will focus on four data sets published by WTO. Here are the description of them. Our data are downloaded from the WHO Coronavirus (COVID-19) Dashboard [website](https://covid19.who.int/data) on Dec. 13, 2022.

### Daily cases and deaths by date reported to WHO

This data set is designed to show the spread of covid-19 virus in countries, territories, and areas around the world from January 2020 to the present (It should be noticed that in our project we get records until Dec. 13, 2022). It contains 8 columns, whose detail descriptions are shown below.

|    Field name     |  Type   |                                                                                                                                                                    Description                                                                                                                                                                    |
|:---------------:|:---------------:|:-------------------------------------:|
|   Date_reported   |  Date   |                                                                                                                                                             Date of reporting to WHO                                                                                                                                                              |
|   Country_code    | String  |                                                                                                                                                             ISO Alpha-2 country code                                                                                                                                                              |
|      Country      | String  |                                                                                                                                                             Country, territory, area                                                                                                                                                              |
|    WHO_region     | String  | WHO regional offices: WHO Member States are grouped into six WHO regions -- Regional Office for Africa (AFRO), Regional Office for the Americas (AMRO), Regional Office for South-East Asia (SEARO), Regional Office for Europe (EURO), Regional Office for the Eastern Mediterranean (EMRO), and Regional Office for the Western Pacific (WPRO). |
|     New_cases     | Integer |                                                                                                               New confirmed cases. Calculated by subtracting previous cumulative case count from current cumulative cases count.\*                                                                                                                |
| Cumulative_cases  | Integer |                                                                                                                                                Cumulative confirmed cases reported to WHO to date.                                                                                                                                                |
|    New_deaths     | Integer |                                                                                                                   New confirmed deaths. Calculated by subtracting previous cumulative deaths from current cumulative deaths.\*                                                                                                                    |
| Cumulative_deaths | Integer |                                                                                                                                               Cumulative confirmed deaths reported to WHO to date.                                                                                                                                                |

```{r}
daily_case <- read.csv(file="./data/WHO-COVID-19-global-data.csv")
# Brief view of the data.
head(daily_case)
```

```{r}
# See the number of countries, territories, and areas.
cat("The number of conuntries, territories, and areas recorded: ",length(unique(daily_case$Country)))
```

```{r}
# See the beginning date and ending date of the records.
print(paste0("The last day of records: ", max(as.Date(daily_case$Date_reported))))
print(paste0("The first day of records: ", min(as.Date(daily_case$Date_reported))))
```

According to the brief view of the data, it is tidy, which means that:

1.  Every column is a variable.
2.  Every row is an observation.
3.  Every cell is a single value.

It contains daily information of 237 countries, territories, and areas from 2020-01-03 to 2022-12-13.

### Latest reported counts of cases and deaths

Different from the data set of daily cases and deaths, this data set focus on the reported cases and deaths in the recent period (recent 7 days, and recent 24 hours). It contains 12 columns, and here are the descriptions of them.

|                          Field name                          |  Type   |                                                                           Description                                                                            |
|:--------------:|:--------------:|:--------------------------------------:|
|                             Name                             | String  |                                                                     Country, territory, area                                                                     |
|                          WHO_region                          | String  |                                                                            WHO Region                                                                            |
|                   Cases - cumulative total                   | Integer |                                                       Cumulative confirmed cases reported to WHO to date.                                                        |
|        Cases - cumulative total per 100000 population        | Decimal |                                            Cumulative confirmed cases reported to WHO to date per 100,000 population.                                            |
|            Cases - newly reported in last 7 days             | Integer |  New confirmed cases reported in the last 7 days. Calculated by subtracting previous cumulative case count (8 days prior) from current cumulative cases count.   |
| Cases - newly reported in last 7 days per 100000 population  | Decimal |                                             New confirmed cases reported in the last 7 days per 100,000 population.                                              |
|           Cases - newly reported in last 24 hours            | Integer |         New confirmed cases reported in the last 24 hours. Calculated by subtracting previous cumulative case count from current cumulative cases count.         |
|                  Deaths - cumulative total                   | Integer |                                                       Cumulative confirmed deaths reported to WHO to date.                                                       |
|       Deaths - cumulative total per 100000 population        | Decimal |                                           Cumulative confirmed deaths reported to WHO to date per 100,000 population.                                            |
|            Deaths - newly reported in last 7 days            | Integer | New confirmed deaths reported in the last 7 days. Calculated by subtracting previous cumulative death count (8 days prior) from current cumulative deaths count. |
| Deaths - newly reported in last 7 days per 100000 population | Decimal |                                             New confirmed deaths reported in the last 7 days per 100,000 population.                                             |
|           Deaths - newly reported in last 24 hours           | Integer |       New confirmed deaths reported in the last 24 hours. Calculated by subtracting previous cumulative death count from current cumulative deaths count.        |

```{r}
reccent_case <- read.csv(file="./data/WHO-COVID-19-global-table-data.csv")
# Brief view of the data.
head(reccent_case)
```

```{r}
# See the number of countries, territories, and areas.
cat("The number of conuntries, territories, and areas recorded: ",length(unique(reccent_case$WHO.Region))-1)
```

According to the brief view of the data set, this data set is tidy as well. Since it focuses on the recent cases, there is no column about the record date. Another thing that should be noticed is that the number of countries, territories, and areas is different from the last data set.

### Vaccination data

This data set shows the vaccination status of covid-19 in different countries, territories, and areas. The descriptions of the 12 columns are shown below.

|              Field name              |   Type  |                                                                                                                                                                   Description                                                                                                                                                                   |
|:------------------------------------:|:-------:|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|
| COUNTRY                              | String  | Country, territory, area                                                                                                                                                                                                                                                                                                                        |
| ISO3                                 | String  | ISO Alpha-3 country code                                                                                                                                                                                                                                                                                                                        |
| WHO_REGION                           | String  | WHO regional offices: WHO Member States are grouped into six WHO regions: Regional Office for Africa (AFRO), Regional Office for the Americas (AMRO), Regional Office for South-East Asia (SEARO), Regional Office for Europe (EURO), Regional Office for the Eastern Mediterranean (EMRO), and Regional Office for the Western Pacific (WPRO). |
| DATA_SOURCE                          | String  | Indicates data source: - REPORTING: Data reported by Member States, or sourced from official reports - OWID: Data sourced from Our World in Data: https://ourworldindata.org/covid-vaccinations                                                                                                                                                 |
| DATE_UPDATED                         | Date    | Date of last update                                                                                                                                                                                                                                                                                                                             |
| TOTAL_VACCINATIONS                   | Integer | Cumulative total vaccine doses administered                                                                                                                                                                                                                                                                                                     |
| PERSONS_VACCINATED_1PLUS_DOSE        | Decimal | Cumulative number of persons vaccinated with at least one dose                                                                                                                                                                                                                                                                                  |
| TOTAL_VACCINATIONS_PER100            | Integer | Cumulative total vaccine doses administered per 100 population                                                                                                                                                                                                                                                                                  |
| PERSONS_VACCINATED_1PLUS_DOSE_PER100 | Decimal | Cumulative persons vaccinated with at least one dose per 100 population                                                                                                                                                                                                                                                                         |
| PERSONS_FULLY_VACCINATED             | Integer | Cumulative number of persons fully vaccinated                                                                                                                                                                                                                                                                                                   |
| PERSONS_FULLY_VACCINATED_PER100      | Decimal | Cumulative number of persons fully vaccinated per 100 population                                                                                                                                                                                                                                                                                |
| VACCINES_USED                        | String  | Combined short name of vaccine: “Company - Product name” (see below)                                                                                                                                                                                                                                                                            |
| FIRST_VACCINE_DATE                   | Date    | Date of first vaccinations. Equivalent to start/launch date of the first vaccine administered in a country.                                                                                                                                                                                                                                     |
| NUMBER_VACCINES_TYPES_USED           | Integer | Number of vaccine types used per country, territory, area                                                                                                                                                                                                                                                                                       |
| PERSONS_BOOSTER_ADD_DOSE             | Integer | Persons received booster or additional dose                                                                                                                                                                                                                                                                                                     |
| PERSONS_BOOSTER_ADD_DOSE_PER100      | Decimal | Persons received booster or additional dose per 100 population                                                                                                                                                                                                                                                                                  |

```{r}
vcc <- read.csv(file = "./data/vaccination-data.csv")
# Brief view of the data.
head(vcc)
```
```{r}
# See the number of countries, territories, and areas.
cat("The number of conuntries, territories, and areas recorded: ",length(unique(vcc$COUNTRY)))
```

The number of countries, territories, and areas is less than the total number of members of WHO, which means that some places still lack vaccine.

### Vaccination metadata

This data set is smaller than the last one and does not provide information about the vaccination population. Here are the detail descriptions about the 10 columns.

|     Field name     |  Type  |                                                                                           Description                                                                                          |
|:------------------:|:------:|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|
| ISO3               | String | ISO Alpha-3 country code                                                                                                                                                                       |
| VACCINE_NAME       | String | Combined short name of vaccine: “Company - Product name” (see below)                                                                                                                           |
| PRODUCT_NAME       | String | Name or label of vaccine product, or type of vaccine (if unnamed).                                                                                                                             |
| COMPANY_NAME       | String | Marketing authorization holder of vaccine product.                                                                                                                                             |
| FIRST_VACCINE_DATE | Date   | Date of first vaccinations. Equivalent to start/launch date of the first vaccine administered in a country.                                                                                    |
| AUTHORIZATION_DATE | Date   | Date vaccine product was authorised for use in the country, territory, area.                                                                                                                   |
| START_DATE         | Date   | Start/launch date of vaccination with vaccine type (excludes vaccinations during clinical trials).                                                                                             |
| END_DATE           | Date   | End date of vaccine rollout                                                                                                                                                                    |
| COMMENT            | String | Comments related to vaccine rollout                                                                                                                                                            |
| DATA_SOURCE        | String | Indicates data source - REPORTING: Data reported by Member States, or sourced from official reports - OWID: Data sourced from Our World in Data: https://ourworldindata.org/covid-vaccinations |

```{r}
vcc_meta <- read.csv(file = "./data/vaccination-metadata.csv")
# Brief view of the data.
head(vcc_meta)
```
```{r}
# See the number of countries, territories, and areas.
cat("The number of conuntries, territories, and areas recorded: ",length(unique(vcc_meta$ISO3)))
```
## Cleaning / transformation
```{r}
library(lubridate)
library(dplyr)
```

```{r}
daily_case$month = month(as.Date(daily_case$Date_reported))
daily_case$year = year(as.Date(daily_case$Date_reported))

group_table = group_by(daily_case, year, month)
```
## Missing value analysis
```{r}
daily_case_na = sum(is.na(daily_case))
reccent_case_na = sum(is.na(reccent_case))
vcc_na = sum(is.na(vcc))
vcc_meta_na = sum(is.na(vcc_meta))

print(paste0("The number of missing values in daily reported and death data set: ", daily_case_na))
print(paste0("The number of missing values in reccent reported and death data set: ", reccent_case_na))
print(paste0("The number of missing values in vaccination data set: ", vcc_na))
print(paste0("The number of missing values in vaccination meat-data set: ", vcc_meta_na))
```

<!--chapter:end:data.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Results

<!--chapter:end:results.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Interactive component


<div id="plot"></div>
<style>
path {
  stroke: white;
  stroke-width: 0.25px;
  fill: grey;
}
</style>

<script src="https://d3js.org/d3.v7.js"></script>
<script src="https://unpkg.com/topojson@3"></script>
<script>
const width = 1000;
const height = 500;

const form = d3.select('div#plot')
  .append('form')
  .attr('class', 'form-inline');
const select = form.append('select')
  .attr('class', 'form-control');
const months = ['2020/1/1', '2020/2/1', '2020/3/1', '2020/4/1','2020/5/1','2020/6/1','2020/7/1','2020/8/1','2020/9/1','2020/10/1','2020/11/1','2020/12/1',
  '2021/1/1','2021/2/1','2021/3/1','2021/4/1','2021/5/1','2021/6/1','2021/7/1','2021/8/1','2021/9/1','2021/10/1','2021/11/1','2021/12/1',
  '2022/1/1','2022/2/1','2022/3/1','2022/4/1','2022/5/1','2022/6/1','2022/7/1','2022/8/1','2022/9/1','2022/10/1','2022/11/1','2022/12/1',
];
select.selectAll('option')
  .data(months)
  .enter()
  .append('option')
    .attr('value', d => d)
    .text(d => d);



const covidData = d3.csv('monthly_with_code.csv').then(function(data){


  let filtered_data = data.filter(d=>d.month == "2020/1/1")
  let colorScale = d3.scaleSequential(d3.interpolateReds)
  .domain([0, d3.max(data, d => d.New_cases)]);
  const projection = d3.geoMercator()
      .center([0, 5 ])
      .scale(150)
      .rotate([-180,0]);

  const svg = d3.select("div#plot")
      .append("svg")
      .attr("width", width)
      .attr("height", height);

  const path = d3.geoPath()
      .projection(projection);

  const g = svg.append("g");
  

  // load and display the World
  d3.json("https://unpkg.com/world-atlas@1.1.4/world/110m.json").then(function(topology) {

      g.selectAll("path")
        .data(topojson.feature(topology, topology.objects.countries).features)
        .enter()
        .append("path")
        .attr("d", path)
        .style('fill',d=>{
          const countrydata = filtered_data.find(
            country => Number(country.code) == Number(d.id) 
          )
          if (typeof(countrydata) == "undefined"){
            return colorScale(0)
          }
          else{
            return colorScale(countrydata.New_cases)
          }
          //return countryData ? colorScale(countryData.New_cases) : '#ccc';
        })
        .style('stroke', '#333');

  });

  select.on('change', () => {
  // get the selected month
  const month = d3.select('.form-control').node().value;

  // update the data to only include cases for the selected month
  filtered_data = data.filter(d=>d.month == month)

  // update the color scale
  // colorScale.domain = [0, d3.max(filteredData, d => d.New_cases)];
  // console.log(filtered_data)
  // update the colors on the map
  svg.selectAll('path')
  .transition()
  .duration(100)
  .style('fill', d => {
  // find the corresponding data for this country
  const countrydata = filtered_data.find(
    country => Number(country.code) == Number(d.id) 
  )
  if (typeof(countrydata) == "undefined"){
    return colorScale(0)
  }
  else{
    return colorScale(countrydata.New_cases)
  }
  })
});

})
</script>

<!--chapter:end:interactive.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Conclusion


<!--chapter:end:conclusion.Rmd-->

